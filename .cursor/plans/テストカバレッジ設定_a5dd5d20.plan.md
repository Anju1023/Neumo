---
name: テストカバレッジ設定
overview: Vitestのカバレッジレポート生成を有効化し、コマンド一発でカバレッジを確認できるようにする。
todos:
  - id: install-coverage
    content: "@vitest/coverage-v8 をインストール"
    status: completed
  - id: add-script
    content: test:coverage スクリプトを追加
    status: completed
  - id: add-thresholds
    content: カバレッジしきい値を設定
    status: completed
  - id: update-gitignore
    content: coverage/ を .gitignore に追加
    status: completed
  - id: verify
    content: カバレッジレポートが生成されることを確認
    status: completed
---

# テストカバレッジ設定

## 現状

[packages/neumo-ui/vitest.config.ts](packages/neumo-ui/vitest.config.ts) にカバレッジ設定は既にある:

```typescript
coverage: {
  provider: "v8",
  reporter: ["text", "json", "html"],
  exclude: [...],
},
```

しかし:

- `@vitest/coverage-v8` パッケージがインストールされていない
- 実行用のスクリプトがない

## 実装内容

### 1. カバレッジプロバイダーのインストール

```bash
pnpm --filter neumo-ui add -D @vitest/coverage-v8
```

### 2. package.json にスクリプト追加

[packages/neumo-ui/package.json](packages/neumo-ui/package.json) に追加:

```json
{
  "scripts": {
    "test:coverage": "vitest run --coverage"
  }
}
```

### 3. カバレッジしきい値の設定（オプション）

[packages/neumo-ui/vitest.config.ts](packages/neumo-ui/vitest.config.ts) に最低カバレッジ率を設定:

```typescript
coverage: {
  // 既存の設定...
  thresholds: {
    lines: 70,
    functions: 70,
    branches: 70,
    statements: 70,
  },
},
```

これにより、カバレッジが70%を下回るとテストが失敗する。

### 4. .gitignore に coverage フォルダを追加

HTMLレポートは `coverage/` フォルダに生成されるため、gitignoreに追加。

## 使い方

```bash
# カバレッジレポート生成
pnpm --filter neumo-ui test:coverage

# または ルートから
pnpm test:coverage
```

レポートは3種類生成される:

- **text**: ターミナルに表示
- **json**: `coverage/coverage-final.json`
- **html**: `coverage/index.html` (ブラウザで開ける)